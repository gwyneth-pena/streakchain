<div class="habit-tracker-container container-fluid">
  <div class="row month-navigation">
    <div class="col-md-12">
      <p>
        <span class="me-2">
          <i class="ti ti-chevron-left" (click)="onCurrentMonthYearChange(-1)"></i>
        </span>
        {{ currentMonthYear.month }} {{ currentMonthYear.year }}
        <span class="ms-2">
          <i class="ti ti-chevron-right" (click)="onCurrentMonthYearChange(1)"></i>
        </span>
      </p>
    </div>
  </div>
  <div class="row">
    <div class="col-md-12 d-flex justify-content-end">
      <button class="btn btn-outline-primary add-habit-btn" (click)="openCreateHabitModal()">
        <i class="ti ti-plus"></i> Add New Habit
      </button>
    </div>
  </div>

  <div class="row calendar-table">
    <div class="col-md-12 table-responsive">
      <table class="table table-hover table-bordered">
        <thead>
          <tr>
            <th class="habit-column">Habits</th>
            @for(day of calendarDays(); track day.day + '-' + currentMonthYear.monthNumber) {
            <th [ngClass]="{ 'today-column': day.isToday }">
              <div>
                <span class="fw-bold" [ngClass]="{ 'text-primary': day.isToday }">
                  {{ day.day }}
                </span>
                <span class="text-muted">{{ day.dayName }}</span>
              </div>
            </th>
            }
            <th>Goal</th>
            <th>Achieved</th>
          </tr>
        </thead>
        <tbody>
          @for(habit of habits(); track habit.id) {
          <tr class="align-middle">
            <td
              class="habit-column"
              [ngStyle]="{
                borderRight: '5px solid ' + habit.color
              }"
            >
              {{ habit.name }}
            </td>
            @for(day of calendarDays(); track day.day) {
            <td
              [ngClass]="{ 'today-column': day.isToday }"
              class="cursor-pointer"
              (click)="
                hasHabitLog(habit, day.day)
                  ? deleteHabitLog(habit.logs[0])
                  : saveHabitLog(habit, day.day)
              "
            >
              @if(hasHabitLog(habit, day.day)) {
              <i
                class="ti ti-star-filled frequency-icon my-0 py-0"
                [ngStyle]="{
                  color: habit.color
                }"
              ></i>
              }
            </td>
            }
            <td>{{ habit.frequency }}</td>
            <td>{{ habit.logs.length }}</td>
          </tr>
          }
        </tbody>
      </table>
    </div>
  </div>
</div>
